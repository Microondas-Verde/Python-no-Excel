from google.colab import drive
import os

drive.mount('/content/drive')

import pandas as pd

# Caminho do arquivo no Drive
caminho = '/content/drive/MyDrive/Colab Notebooks/Python.xlsx'

# Verifica e cria diretório se necessário
directory = os.path.dirname(caminho)
if not os.path.exists(directory):
    os.makedirs(directory)

# Verifica e cria arquivo se necessário
if not os.path.exists(caminho):
    # Ensure all columns are initialized, including new ones
    df = pd.DataFrame({'Nome': [], 'Idade': [], 'Email': [], 'CPF': [], 'Cidade': [], 'Estado': [], 'Carro': [], 'Música': [], 'Artista': []})
    df.to_excel(caminho, index=False)

# Carregar o arquivo existente
df = pd.read_excel(caminho)

# Garante que todas colunas existam
for col in ['Nome', 'Idade', 'Email', 'CPF', 'Cidade', 'Estado', 'Carro', 'Música', 'Artista']:
    if col not in df.columns:
        df[col] = None

# Remove duplicados
if 'Nome' in df.columns:
    df.drop_duplicates(subset=['Nome'], keep='last', inplace=True)

# Função melhorada para adicionar/atualizar
def add_or_update_person(dataframe, person_data):
    person_name = person_data.get('Nome')
    if person_name is None:
        print("Error: 'Nome' is required in person_data.")
        return dataframe # Return the original dataframe if no name is provided

    # Add new columns if they don't exist in the dataframe
    for col in person_data.keys():
        if col not in dataframe.columns:
            dataframe[col] = None

    if person_name in dataframe['Nome'].values:
        # If the person exists, update the existing row
        for col, value in person_data.items():
            # Only update if the column exists in the dataframe
            if col in dataframe.columns:
                dataframe.loc[dataframe['Nome'] == person_name, col] = value
    else:
        # If the person does not exist, add a new row
        dataframe = pd.concat([dataframe, pd.DataFrame([person_data])], ignore_index=True)
    return dataframe

# --- Get user input for a new person ---
print("Digite suas informações:")
nome = input("Nome: ")
idade = input("Idade: ") # Note: input is string, may need conversion later
email = input("Email: ")
cpf = input("CPF: ")
cidade = input("Cidade: ")
estado = input("Estado: ")
carro = input("Carro: ")
musica = input("Música: ")
artista = input("Artista: ")

# Create a dictionary with the user's input
person_data_user = {
    'Nome': nome,
    'Idade': idade,
    'Email': email,
    'CPF': cpf,
    'Cidade': cidade,
    'Estado': estado,
    'Carro': carro,
    'Música': musica,
    'Artista': artista
}

# Add or update the person using the user's input
df = add_or_update_person(df, person_data_user)
# --- End of user input section ---


# Salvar de volta no mesmo arquivo
df.to_excel(caminho, index=False)

print("\nArquivo atualizado no Google Drive!")
